
# Duplicate Reads

In this step, the pipeline marks duplicate reads. Duplicate reads are sequencing artifacts that originate during library preparation and sequencing runs. Duplicate reads are evaluated per-library using the `LB` tag in the read groups.

The pipeline does not remove the duplicate reads that are tagged directly in the BAM file.

## Detecting and Marking Duplicates

##### Detect duplicate reads

```text
sentieon driver -i sorted.bam
                --algo LocusCollector
                --fun score_info
                score.txt
```

##### Mark duplicate reads

```text
sentieon driver -i sorted.bam
                --algo Dedup
                --optical_dup_pix_dist 2500
                --score_info score.txt
                deduped.bam
```

Arguments:

- *-\-optical_dup_pix_dist*: maximum offset between two duplicate clusters to consider them optical duplicates. For structured flow cells (NovaSeq, HiSeq 4000, X), the pipeline uses 2500.

*Note: The actual implementation of the above command in the pipeline is more complex to support distributed execution, but functionally equivalent.*

## Integrity Check

To confirm the integrity of the alignment BAM file, in-house Python code checks for the presence of the 28-byte empty block representing the EOF marker in BAM format.

## Implementation with Sentieon

The pipeline implementation uses Sentieon LocusCollector to calculate duplicate metrics per library and the Dedup algorithm to mark duplicate reads in the BAM file. The pipeline is using Sentieon version 202308.01, corresponding to Picard 2.9.0. Both algorithms combined are equivalent to the MarkDuplicates algorithm in Picard.

##### Detect and mark duplicate reads (Picard equivalent)

```text
java -jar picard.jar MarkDuplicates
      INPUT=sorted.bam
      OPTICAL_DUPLICATE_PIXEL_DISTANCE=2500
      OUTPUT=deduped.bam
```

## Source Code

All the relevant code can be accessed in the GitHub repository:

  - [sentieon_LocusCollector.sh](https://github.com/smaht-dac/sentieon-pipelines/blob/main/dockerfiles/sentieon/sentieon_LocusCollector.sh) [LocusCollector]
  - [sentieon_LocusCollector_apply.sh](https://github.com/smaht-dac/sentieon-pipelines/blob/main/dockerfiles/sentieon/sentieon_LocusCollector_apply.sh) [Dedup]

---

<!-- This section relies on the html links generated by GitHub Pages 
and will not render correctly in Markdown -->
<div style="text-align: right">
    <a href="/pipelines-docs/"> Home </a> -
    <a href="0_Overview.html"> Overview </a> -
    <a href="1_Alignment.html"> Alignment </a> -
    <a href="2_Read_Groups.html"> Read Groups </a> -
    <a> <b> Duplicate Reads </b> </a> -
    <a href="4_Local_Realignment.html"> Local Realignment </a> -
    <a href="5_Base_Quality_Score_Recalibration.html"> Base Quality Score Recalibration </a> -
    <a href="6_Hi-C.html"> Hi-C </a>
</div>