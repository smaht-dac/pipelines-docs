
# Isoform Classification and Filtering

In this step, the pipeline uses Pigeon to classify collapsed isoforms and filter out potential artifacts. Pigeon categorizes isoforms based on their splice junctions and structural similarity to known reference annotations. This classification helps in identifying known, novel, and potentially artifactual transcripts.

The output includes a set of high-confidence isoforms, along with detailed classification metrics and annotations.

## Classifying and Filtering Isoforms

##### Prepare the reference annotation and genome

```text
pigeon prepare annotation.gtf reference.fasta
```

This command sorts and indexes the GTF annotation and genome FASTA for compatibility with Pigeon.

*Note: The annotation file used is the GENCODE comprehensive gene annotations. For more detailed information please refer to the GENCODE documentation under “Genome Annotations” section.*

#####  Prepare the collapsed isoforms

```text
pigeon prepare collapsed_isoforms.gff
```

This command formats and indexes the collapsed isoforms generated in the previous step for compatibility with Pigeon.

##### Classify isoforms

```text
pigeon classify \
  collapsed_isoforms.gff \
  annotation.gtf \
  reference.fasta  \
  --fl flnc_count.txt \
  --cage-peak refTSS.bed \
  --poly-a polyA.list
```

Arguments:

- *isoform, annotation, and reference input files must be preprocessed using the pigeon prepare step.*
- *-\-fl*: file with FLNC read counts from the collapsing step. Required to include read support in the classification output.
- *-\-cage-peak*: BED file with CAGE peaks information. Used to improve annotation of transcription start sites (TSS).
- *-\-poly-a*: file in Pigeon custom format with polyA motifs. Used to improve annotation of polyA sites.

*Note: The refTSS.bed and polyA.list files used by the pipeline are provided by PacBio as part of their reference resource bundle and can be downloaded [here](https://downloads.pacbcloud.com/public/dataset/Kinnex-full-length-RNA).*

##### Filter high-confidence isoforms

```text
pigeon filter classification.txt --isoforms collapsed_isoforms.gff
```

Arguments:

- *isoform input file must also be preprocessed using pigeon prepare.*
- *-\-isoforms* enables generation of a filtered GFF file as additional output.

This command filters isoforms from the classification output.

## Implementation with Pigeon

The pipeline uses [Pigeon](https://github.com/PacificBiosciences/Pigeon) version 1.3.0.

## Source Code

All the relevant code can be accessed in the GitHub repository:

  - [pigeon_prepare.sh](https://github.com/smaht-dac/rnaseq-pipelines/blob/main/dockerfiles/pigeon/pigeon_prepare.sh) [prepare]
  - [pigeon_classify.sh](https://github.com/smaht-dac/rnaseq-pipelines/blob/main/dockerfiles/pigeon/pigeon_classify.sh) [classify]
  - [pigeon_filter.sh](https://github.com/smaht-dac/rnaseq-pipelines/blob/main/dockerfiles/pigeon/pigeon_filter.sh) [filter]

---

<!-- This section relies on the html links generated by GitHub Pages 
and will not render correctly in Markdown -->
<div style="text-align: right">
    <a href="/pipelines-docs/"> Home </a> -
    <a href="0_Overview.html"> Overview </a> -
    <a href="1_Clustering.html"> Clustering </a> -
    <a href="2_Alignment.html"> Alignment </a> -
    <a href="3_Collapsing.html"> Collapsing </a> -
    <a> <b> Classification and Filtering </b> </a> -
    <a href="5_Annotation.html"> Annotation </a>
</div>